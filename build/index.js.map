{"version":3,"sources":["index.js"],"names":["path","require","tar","fs","module","exports","installGit","options","targetDirectory","updateEnv","undefined","createReadStream","join","__dirname","pipe","extract","GIT_TEMPLATE_DIR","GIT_EXEC_PATH","binPath","process","env","PATH"],"mappings":";;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,MAAMD,QAAQ,QAAR,CAAZ;AACA,IAAME,KAAKF,QAAQ,IAAR,CAAX;;AAEA;;;;;;;;;;;;;AAaAG,OAAOC,OAAP,GAAiB,SAASC,UAAT,CAAoBC,OAApB,EAA6B;AAC5CA,YAAUA,WAAW,EAArB,CAD4C,CACnB;;AAEzB,MAAMC,kBAAkBD,QAAQC,eAAR,IAA2B,UAAnD;AACA,MAAMC,YAAaF,QAAQE,SAAR,KAAsBC,SAAvB,GAAoCH,QAAQE,SAA5C,GAAwD,IAA1E;;AAEAN,KAAGQ,gBAAH,CAAoBX,KAAKY,IAAL,CAAUC,SAAV,EAAqB,eAArB,CAApB,EACGC,IADH,CACQZ,IAAIa,OAAJ,CAAYP,eAAZ,CADR;;AAGA,MAAMQ,mBAAmBhB,KAAKY,IAAL,CAAUJ,eAAV,EAA2B,8BAA3B,CAAzB;AACA,MAAMS,gBAAgBjB,KAAKY,IAAL,CAAUJ,eAAV,EAA2B,sBAA3B,CAAtB;AACA,MAAMU,UAAUlB,KAAKY,IAAL,CAAUJ,eAAV,EAA2B,SAA3B,CAAhB;;AAEA,MAAIC,SAAJ,EAAe;AACbU,YAAQC,GAAR,CAAYC,IAAZ,GAAsBF,QAAQC,GAAR,CAAYC,IAAlC,SAA0CH,OAA1C;AACAC,YAAQC,GAAR,CAAYJ,gBAAZ,GAA+BA,gBAA/B;AACAG,YAAQC,GAAR,CAAYH,aAAZ,GAA4BA,aAA5B;AACD;AACD,SAAO;AACLC,aAASA,OADJ;AAELE,SAAK;AACHJ,wBAAkBA,gBADf;AAEHC,qBAAeA;AAFZ;AAFA,GAAP;AAOD,CAzBD","file":"index.js","sourcesContent":["const path = require('path');\nconst tar = require('tar-fs');\nconst fs = require('fs');\n\n/**\n * Installs git binaries and updates this process's PATH to include\n * them, so you can child_process.exec('git') successfully.\n *\n * Git bundle is extracted to the the target directory. This defaults to\n * /tmp/git, but can be set with the `targetDirectory` option.\n *\n * The current process's path is prefixed with the binary folder, and other\n * required env vars for Git are set. If you set `updateEnv` to false in\n * your options then no changes will be made an object will be returned\n * instead including `binPath` (the path to the binaries folder) and `env`,\n * a set of required environmental variables.\n */\nmodule.exports = function installGit(options) {\n  options = options || {}; //eslint-disable-line no-param-reassign\n\n  const targetDirectory = options.targetDirectory || '/tmp/git';\n  const updateEnv = (options.updateEnv !== undefined) ? options.updateEnv : true;\n\n  fs.createReadStream(path.join(__dirname, 'git-2.4.3.tar'))\n    .pipe(tar.extract(targetDirectory));\n\n  const GIT_TEMPLATE_DIR = path.join(targetDirectory, 'usr/share/git-core/templates');\n  const GIT_EXEC_PATH = path.join(targetDirectory, 'usr/libexec/git-core');\n  const binPath = path.join(targetDirectory, 'usr/bin');\n\n  if (updateEnv) {\n    process.env.PATH = `${process.env.PATH}:${binPath}`;\n    process.env.GIT_TEMPLATE_DIR = GIT_TEMPLATE_DIR;\n    process.env.GIT_EXEC_PATH = GIT_EXEC_PATH;\n  }\n  return {\n    binPath: binPath,\n    env: {\n      GIT_TEMPLATE_DIR: GIT_TEMPLATE_DIR,\n      GIT_EXEC_PATH: GIT_EXEC_PATH\n    }\n  };\n};\n"]}